import React, {Component} from 'react';
import Frame from "./Frame";
import sch from "../imgs/search.png";
import lock from "../imgs/lock.png";
import peo from "../imgs/peo.png";
import site from "../imgs/site.png";
import res from "../imgs/res.png";
import loc from "../imgs/loc.png";
import locc from "../imgs/locc.png";
import type from "../imgs/type.png";
import Button from '@material-ui/core/Button';
import Navigation from "./Navigation";
import FrameTitle from "./FrameTitle";
import Grid from '@material-ui/core/Grid';
import SiteorApp from "./SiteorApp";
import Location from "./Location";
import Visitnum from "./Visitnum";
import "../assets/css/anim.css"
import axios from "../Utils/axios"
import { Map, Marker } from 'react-amap';
import { Box } from '@material-ui/core';
var pjson = require('../../package.json')
var pjsonUrl = pjson.config.url


React.axios = axios
export default class ExploitSite extends Component {
    constructor (props) {
        super(props);

        this.state = {
            sitecenter:{
                longitude: '',
                latitude: '',
            },
            siteaddress:'',
            appcenter:{
                longitude: '',
                latitude: '',
            },
            appaddress:'',
            img_number:1,
            siteIp:"",
            location:"",
            registrar:"",
            registerTime:"",
            redirect:[],
            type:"",
            peopleNum:0,
            screenshotsite:'',
            certificate:{
            },
            relatedSites:[],
            relatedApp:"",
            appDomain:"",
            appIp:"",
            appLocation:"",
            family:"",
            platform:"",
            version:"",
            produceTime:"",
            paymentChannel:'',
            accounts:'',
            signature:{},
            screenshotapp:'',
            relatedSite:"",
            url: "www.40220b.com",
            flag: false,
            opacity: ["block","block","block","block","rright","rright","rright","hide"],
            myLong:0,
            myLat:0
        }
    }

    handleChange = event => {
        this.setState({ url: event.target.value });
    }
    //site
    savesiteIp=(siteIp )=>{
        this.setState({
            siteIp :siteIp
        })
    }
    savelocation=(location)=>{
        this.setState({
            location:location
        })
    }
    saveregistrar=(registrar)=>{
        this.setState({
            registrar:registrar
        })
    }
    saveregisterTime=(registerTime)=>{
        this.setState({
            registerTime:registerTime
        })
    }
    saveredirect=(redirect)=>{
        this.setState({
            redirect:redirect
        })
    }
    savetype=(type)=>{
        this.setState({
            type:type
        })
    }
    savepeopleNum=(peopleNum)=>{
        this.setState({
            peopleNum:peopleNum
        })
    }
    savecertificate=(certificate)=>{
        this.setState({
            certificate:certificate
        })
    }
    saverelatedSites=(relatedSites)=>{
        this.setState({
            relatedSites:relatedSites
        })
    }
    saverelatedApp=(relatedApp)=>{
        this.setState({
            relatedApp:relatedApp
        })
    }    
    savescreenshotSite=(screenshotsite)=>{
        this.setState({
            screenshotsite:screenshotsite
        })
    }
    savesiteCenter=(lat,long)=>{
        let pos = this.state.sitecenter;
        console.log(this.state.sitecenter);
        pos.latitude = lat;
        pos.longitude = long;
        this.setState({
            sitecenter:pos
        })
    }
    savesiteAddress=(address)=>{
        this.setState({
            siteaddress:address
        })
    }
    saveMyLong=(myLong)=>{
        this.setState({
            myLong:myLong
        })
    }
    saveMyLat=(myLat)=>{
        this.setState({
            myLat:myLat
        })
    }
    // 提交按钮触发方法
    search_new_finding_data = (e)=>{
        // alert(" 55")
         e.preventDefault();
        console.log("!!!in");
        let input_url = this.state.url
        if(input_url===""){
             input_url="www.40220b.com";
         }
         
        axios.get(pjsonUrl+'/exploit/findSitesByDomain?url='+input_url).then(
            response => {
                // 移除动画
                this.removeAnimation()
                this.func()
                
                // setInterval(this.add,1050);
                // 需要IP，位置， 注册信息， 注册时间等等
                this.savesiteIp(response.data.ip)
                this.savelocation(response.data.location)
                this.saveregistrar(response.data.registrar)
                this.saveregisterTime(response.data.registerTime)
                this.saveredirect(response.data.redirect)
                this.savetype(response.data.type)
                this.savepeopleNum(response.data.peopleNum)
                this.savecertificate(response.data.certificate)
                this.saverelatedSites(response.data.relatedSites)
                this.saverelatedApp(response.data.relatedApp)
                this.savescreenshotSite(response.data.screenshot)
                this.savesiteCenter(response.data.lat,response.data.long)
                this.savesiteAddress(response.data.address)

                this.saveMyLong(response.data.long)
                this.saveMyLat(response.data.lat)
            },
        )
    }

    componentDidMount() {
        // setTimeout(this.func,1200);
        this.state.opacity[0] = "block2";
        this.state.opacity[1] = "block2";
        this.state.opacity[2] = "block2";
        this.state.opacity[3] = "block2";
        this.state.opacity[5] = "rright2";
        this.state.opacity[6] = "rright2";
        this.state.opacity[7] = "show";

        let input_url = this.state.url
       
        axios.get(pjsonUrl+'/exploit/findSitesByDomain?url='+input_url).then(
            response => {
                this.removeAnimation()
                this.func()
                 setInterval(this.add,1050);
                this.savesiteIp(response.data.ip)
                this.savelocation(response.data.location)
                this.saveregistrar(response.data.registrar)
                this.saveregisterTime(response.data.registerTime)
                this.saveredirect(response.data.redirect)
                this.savetype(response.data.type)
                this.savepeopleNum(response.data.peopleNum)
                this.savecertificate(response.data.certificate)
                this.saverelatedSites(response.data.relatedSites)
                this.saverelatedApp(response.data.relatedApp)
                this.savescreenshotSite(response.data.screenshot)
                this.savesiteCenter(response.data.lat,response.data.long)
                this.savesiteAddress(response.data.address)

                this.saveMyLong(response.data.long)
                this.saveMyLat(response.data.lat)

            },
        )
    }
    func = () => {
        this.id = setInterval(this.add,1050);
    }

    removeAnimation = () =>{
        this.state.opacity[0] = "block";
        this.state.opacity[1] = "block";
        this.state.opacity[2] = "block";
        this.state.opacity[3] = "block";
        this.state.opacity[5] = "rright";
        this.state.opacity[6] = "rright";
        this.state.opacity[7] = "hide";
    }

    add = () =>{
        if (this.state.opacity[0] == "block") {
            this.state.opacity[0] = "block2"
            this.setState({
                display: this.state.opacity
            });
        }else if (this.state.opacity[1] == "block") {
            this.state.opacity[1] = "block2"
            this.setState({
                display: this.state.opacity
            });
        }else if (this.state.opacity[2] == "block") {
            this.state.opacity[2] = "block2"
            this.setState({
                display: this.state.opacity
            });
        }else if (this.state.opacity[3] == "block") {
            this.state.opacity[3] = "block2"
            this.setState({
                display: this.state.opacity
            });
        }else if (this.state.flag == false) {
            this.setState({
                flag: true
            });
        }else if (this.state.opacity[5] == "rright") {
            this.state.opacity[5] = "rright2"
            this.setState({
                display: this.state.opacity
            });
        }else if (this.state.opacity[6] == "rright") {
            this.state.opacity[6] = "rright2"
            this.setState({
                display: this.state.opacity
            });
        }else if (this.state.opacity[7] == "hide") {
            this.state.opacity[7] = "show"
            this.setState({
                display: this.state.opacity
            });
        }else{
            //左侧定时显示
            clearInterval(this.id);
        }
    }
    handleOnclick(value){
        this.props.fatherChange(value);
    }
    render(){
        return(
            
                <Box sx={{ flexGrow: 1 }} style={{width :"96%",marginLeft:"2%"}}>
                <Grid container spacing={6}>
                    <Grid item xs={4}>
                    <div 
                            style={{
                                height: '16rem',
                                display: "flex", flexDirection: "column"
                              }}>
                    
                    <div  style={{
                                height: '10%',
                              }}>
                        <Frame  heightZZ = "100">
                        <FrameTitle value={"放入域名"} />
                        {/* 第一次触发不是B */}
                            <form className="seed" onSubmit={this.search_new_finding_data}> 
                                <div className="seed3">
                                    <div className="seed1" style={{textAlign:"center"}}>域名</div>
                                    {/* <select value={this.state.url} onChange={this.handleChange} style={{width:"100%"}}>
                                            {
                                                this.props.initSites.map((value, key) => {
                                                    return (
                                                        <option value={value}>{value}</option>
                                                    )
                                                })
                                            }
                                    </select> */}
                                    <input className='seed2' type="text" name="url" placeholder="www.40220b.com" onChange={this.handleChange}/>
                                </div>
                                {/* <div className="seed3">
                                    <div className="seed1">IP</div>
                                    <div className="seed2">112.121.175.38</div>
                                </div> */}
                                
                                <div className="se" style={{textAlign:"center"}}>
                                    <button type='submit' style={{backgroundColor:"#2274A5", padding:"5px 50px", color:"white"}}>点击放入种子</button>
                                </div>
                            </form>
                        </Frame>
                        </div>
                        <SiteorApp
                            grandfatherChange={this.state.fatherChange}
                            active={0}
                            screenshotsite={this.state.screenshotsite}
                            />                  
                    </div>              
                    </Grid>
                    <Grid item xs={4}>
                    
                    <div 
                            style={{
                                height: '16rem',
                                display: "flex", flexDirection: "column"
                              }}>
                            <div  style={{
                                height: '73%',
                              }}>
                            <Frame  heightZZ = "100">
                                <FrameTitle value={"网站信息"}/>
                                <div>
                                    <div className={this.state.opacity[0]} style={{display:"flex"}}>
                                        <Grid item xs={1}>
                                            <img src={loc} className="loc" alt=""/>
                                        </Grid>
                                        <Grid item xs={10}>
                                            <div style={{position:"relative",left:"5%",width:'95%'}}>
                                                <p className="text1">IP地址</p>
                                                <p className="text2">{this.state.siteIp}</p>
                                                
                                                {/* <Location sitecenter={this.state.sitecenter} flag="site" siteaddress={this.state.siteaddress}/> */}
                                                <div>
                                                    <p className="text6">IP定位地点 :   <b>{this.state.siteaddress}</b></p>
                                                    <div id="map" style={{ width: '100%', height: '220px', position: 'relative',display:"block" }}>
                                                        <Map zoom={6} center={{ longitude: this.state.myLong, latitude: this.state.myLat }} amapkey="a1538be955e5ace2256f15972571046d">
                                                            <Marker position={{ longitude: this.state.myLong, latitude: this.state.myLat }}/>
                                                        </Map>
                                                    </div>
                                                </div>
                                                <br></br>
                                            </div>
                                        </Grid>
                                    </div>
                                    <div className={this.state.opacity[1]} style={{display:'flex'}}>
                                        <Grid item xs={1}>
                                            <img src={res} className="loc" alt=""/>
                                        </Grid>
                                        <Grid item xs={10}>
                                        <div style={{position:"relative",left:"5%"}}>
                                            <p className="text1">网站主体信息</p>
                                            <p className="text2">{this.state.registrar}</p>
                                            <p className="text2">{this.state.registerTime}</p>
                                        </div>
                                        </Grid>
                                    </div>
                                    <div className={this.state.opacity[2]} style={{display:'flex'}}>
                                        <Grid item xs={1}>
                                            <img src={locc} className="loc" alt=""/>
                                        </Grid>
                                        <Grid item xs={10}>
                                        <div style={{position:"relative",left:"5%"}}>
                                            <p className="text1">后台服务器地址</p>
                                            
                                            {
                                                this.state.redirect.map((Obj)=>{
                                                    return(
                                                        <div>
                                                            
                                                                <p className = "text2">{Obj}</p>
                                                            
                                                        </div>
                                                    )
                                                })
                                            }
                                        </div>
                                        </Grid>
                                    </div>
                                    <div className={this.state.opacity[3]} style={{marginBottom:"30px",display:'flex'}}>
                                        <Grid item xs={1}>
                                            <img src={type} className="loc" alt=""/>
                                        </Grid>
                                        <Grid item xs={10}>
                                        <div style={{position:"relative",left:"5%"}}>
                                            <p className="text1">网站类型</p>
                                            <p className="text2">{this.state.type}</p>
                                        </div>
                                        </Grid>
                                    </div>
                                </div>
                            </Frame>
                            </div>
                        </div>
                    
                    </Grid>
                <Grid item xs={4}>
                    
                         <div 
                            style={{
                                height: '16rem',
                                display: "flex", flexDirection: "column"
                              }}>
                            <div  style={{
                                height: '30%',
                              }}>
                            <Frame  heightZZ = "100">
                                <FrameTitle value={"网站证书信息"}/>
                                <div className={this.state.opacity[5]}>
                                    <Grid item xs={1}>
                                        <img src={lock} className="lock" alt=""/>
                                    </Grid>
                                    <Grid item xs={9}>
                                        <div style={{position:"relative",width:"95%",left:"5%"}}>
                                            <p className="text1">证书类型</p>
                                            <p className="text2">{this.state.certificate.certType}</p>
                                            <p className="text1">证书颁发者</p>
                                            <p className="text2">{this.state.certificate.issuer}</p>
                                            <p className="text1">证书序列号</p>
                                            <p className="text2">{this.state.certificate.certSerial}</p>
                                            
                                            <p className="text1">证书有效期</p>
                                            <p className="text2">{this.state.certificate.expireTime}</p>
                                        </div>
                                    </Grid>
                                </div>
                            </Frame>
                        </div>
                        <div  style={{
                                height: '3%',
                              }}/>
                        <div  style={{
                                height: '40%',
                              }}>
                            <Frame  heightZZ = "100">
                                <FrameTitle value={"潜在同伙网站"}/>
                                <div className={this.state.opacity[6]}>
                                    <Grid item xs={1}>
                                        <img src={site} className="site" alt=""/>
                                    </Grid>
                                    <Grid item xs={9}>
                                        <div style={{position:"relative",width:"95%",left:"5%"}}>
                                            {
                                                this.state.relatedSites.map((Obj)=>{
                                                    return(
                                                        <div>
                                                            
                                                                <p className = "text2">{Obj}</p>
                                                            
                                                        </div>
                                                    )
                                                })
                                            }
                                            <p className="text2">{this.state.certificate.subject}</p>
                                        </div>
                                    </Grid>
                                </div>
                            </Frame>
                        </div>
                        {/* <div style={{marginTop:"30px"}}>
                            <Frame>
                                <div className={this.state.opacity[7]}>
                                    <img src={sch} className="icon" alt=""/>
                                    <Grid item xs={8}>
                                        <div style={{position:"relative",left:"10%",marginTop:"10px",marginBottom:"10px"}}>
                                            <p className="text1">检测到可下载App</p>
                                        </div>
                                    </Grid>
                                    <Grid item xs={4}>
                                        <div style={{marginTop:"10px"}}>
                                            <Button size="small" style={{backgroundColor:"#3ac0d8",color:"white"}} onClick={this.handleOnclick.bind(this,2)}>查看一下</Button>
                                        </div>
                                    </Grid>
                                </div>
                            </Frame>
                        </div> */}
                    </div>
                    </Grid>

                </Grid>
                </Box>
            
        )
    }
}
